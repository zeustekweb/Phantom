<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0a0a0f">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Phantom">
<meta name="mobile-web-app-capable" content="yes">
<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, private">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
<meta name="referrer" content="no-referrer">
<title>Phantom</title>
<link rel="apple-touch-icon" href="data:image/png;base64,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">
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACeUlEQVR42s1XPWzTQBT+LmoTwghpQgbUgYGCQNAskcCDJy9ZGiaYOa9dKkWqRajUolqyxMJqIzGVAYmydHCHNhIQ0YFKVAjSgcFisEoKGwixHIPt5OK68U+cwLOi+Ofufd/73vn5HkGAncmeYxiD/f7zg/jvkUkADyOSmTS4H4skBX90++Msf/3g7TUriRKZJBH4wU+7F8VI3Oh5oEq1bAHA/p49m1SJzCjglUVs8USSKJEoBQPgASTGTgAA9p+gxv8ntRgE+iXDyzkPzq8DZyxJkwCBInbkX9PTUhAgf95s37AUsSMrYkeOQiLSW6CIh7LauqKDOA7Xbn0IXGgP2zctBtcdY1gWP8vrrcv6iAq4UbjgBAQr7fkTC26lPW8ROAc/PkyFUAX46PsAjtOXDdsAgDtamfZnsN4RRYWpqNHz0XnAW9tvHrvX4Il44xjh/bD4Cvij32wcDQD7rSYJSw6RCzSqCrHrAA9OVcGkqmAGPRt7IUrL0iBgj5WAl0fmW0RUFd574FQVnvnnnDYvcHcy7LcqdWk+W2D53AzL52aY2WS62WT6wQ77uVh9PXeww95552aT6Wdzxd7YfLbAVqUuHeY/VIFL5YJk3Ou+AHMiWdCKtK6VqL2LDVeF6/YuNmqSsFTXStSL2Lj7bS80+iiF6Oun78sAcPFqQSUgAxURADYbR0ZdK9FeulxwqYlXzrzz6jD/U2EMt9dQ4XNLvFLvFpkFrdivgq5K958Xqk9xjC/2sZHalkwRD2UAWG/N6bwCJxYsAOdLCIR9iBLtCf1EBp9FB05MwE+EtzjAI/cFaXVI/0cpDmoaJ9UfZoZ1rpNoTsm/bs//AovsRB+QslnoAAAAAElFTkSuQmCC">
<script>
(function(){
  var m="{\"name\": \"Phantom\", \"short_name\": \"Phantom\", \"description\": \"Anonymous encrypted chat\", \"display\": \"standalone\", \"background_color\": \"#080612\", \"theme_color\": \"#0a0a0f\", \"start_url\": \"/\", \"icons\": [{\"src\": \"data:image/png;base64,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\", \"sizes\": \"192x192\", \"type\": \"image/png\"}, {\"src\": \"data:image/png;base64,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\", \"sizes\": \"512x512\", \"type\": \"image/png\"}]}";
  var b=new Blob([m],{type:'application/manifest+json'});
  var l=document.createElement('link');
  l.rel='manifest'; l.href=URL.createObjectURL(b);
  document.head.appendChild(l);
})();
</script>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#08080f;--bg2:#0d0d18;--bg3:#12121f;--bg4:#181828;
  --border:rgba(255,255,255,0.05);--border2:rgba(255,255,255,0.1);
  --accent:#7c3aed;--accent2:#a855f7;--accent3:#c084fc;
  --green:#22c55e;--green2:#4ade80;--red:#ef4444;--amber:#f59e0b;
  --text:#e2e8f0;--text2:#94a3b8;--text3:#475569;
  --sat:env(safe-area-inset-top,0px);--sab:env(safe-area-inset-bottom,0px);
  --sal:env(safe-area-inset-left,0px);--sar:env(safe-area-inset-right,0px);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;height:100%;overflow:hidden;background:var(--bg);color:var(--text);
  font-family:'Syne',sans-serif;overscroll-behavior:none;-webkit-overflow-scrolling:touch;
  -webkit-user-select:none;user-select:none;}
body::after{content:'';position:fixed;top:-20vh;left:50%;transform:translateX(-50%);
  width:100vw;height:70vh;
  background:radial-gradient(ellipse,rgba(124,58,237,.07) 0%,transparent 65%);
  pointer-events:none;z-index:0;}
body::before{content:'';position:fixed;inset:0;z-index:1000;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events:none;opacity:.5;}
.screen{position:fixed;inset:0;z-index:10;display:flex;align-items:center;justify-content:center;
  padding:calc(var(--sat) + 16px) calc(var(--sar) + 16px) calc(var(--sab) + 16px) calc(var(--sal) + 16px);
  transition:opacity .3s ease,transform .3s ease;overflow-y:auto;-webkit-overflow-scrolling:touch;}
.screen.hidden{opacity:0;pointer-events:none;transform:translateY(12px);}
.screen-inner{width:100%;max-width:420px;display:flex;flex-direction:column;align-items:center;padding:12px 0 28px;}

/* HOME */
#homeScreen{flex-direction:column;}
.logo-wrap{display:flex;flex-direction:column;align-items:center;margin-bottom:28px;}
.logo-svg-container{width:min(70px,18vw);height:min(70px,18vw);margin-bottom:18px;flex-shrink:0;}
.logo-svg-container svg{width:100%;height:100%;}
.logo-ring{animation:spinRing 10s linear infinite;transform-origin:32px 32px;}
@keyframes spinRing{to{transform:rotate(360deg)}}
h1{font-size:clamp(2rem,9vw,3.8rem);font-weight:800;letter-spacing:-.04em;line-height:1;
  background:linear-gradient(135deg,#fff 0%,var(--accent3) 55%,var(--accent) 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  margin-bottom:9px;text-align:center;}
.tagline{font-family:'Space Mono',monospace;font-size:clamp(.58rem,2.4vw,.7rem);
  color:var(--text3);letter-spacing:.14em;text-transform:uppercase;text-align:center;}
.home-actions{display:flex;flex-direction:column;gap:10px;width:100%;margin-top:32px;}

/* BUTTONS */
.btn{display:flex;align-items:center;justify-content:center;gap:9px;padding:15px 22px;
  border-radius:14px;font-family:'Syne',sans-serif;font-size:clamp(.88rem,3.5vw,.95rem);
  font-weight:700;cursor:pointer;border:none;transition:all .18s ease;
  position:relative;overflow:hidden;-webkit-tap-highlight-color:transparent;min-height:52px;}
.btn:active{transform:scale(.97);}
.btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;
  box-shadow:0 0 26px rgba(124,58,237,.28),0 4px 14px rgba(0,0,0,.25);}
.btn-secondary{background:var(--bg3);color:var(--text);border:1px solid var(--border2);}
.btn-ghost{background:transparent;color:var(--text2);border:1px solid var(--border);font-size:.85rem;}
.btn-danger{background:rgba(239,68,68,.08);color:var(--red);border:1px solid rgba(239,68,68,.2);}

.badges{display:flex;gap:6px;flex-wrap:wrap;justify-content:center;margin-top:26px;}
.badge{font-family:'Space Mono',monospace;font-size:clamp(.5rem,1.9vw,.6rem);
  letter-spacing:.07em;text-transform:uppercase;padding:4px 9px;
  border-radius:20px;border:1px solid var(--border2);color:var(--text3);}
.badge.green{border-color:rgba(34,197,94,.28);color:var(--green);}
.badge.amber{border-color:rgba(245,158,11,.28);color:var(--amber);}

/* CARD */
.card{background:var(--bg2);border:1px solid var(--border);border-radius:22px;
  padding:clamp(18px,5vw,30px);width:100%;position:relative;overflow:hidden;}
.card::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);
  width:55%;height:1px;background:linear-gradient(90deg,transparent,var(--accent2),transparent);}
.card-title{font-size:clamp(1.05rem,4vw,1.25rem);font-weight:700;margin-bottom:5px;}
.card-sub{font-family:'Space Mono',monospace;font-size:clamp(.6rem,2.4vw,.68rem);
  color:var(--text3);margin-bottom:20px;letter-spacing:.04em;line-height:1.5;}

/* QR */
.qr-wrapper{background:#fff;border-radius:14px;padding:10px;width:fit-content;
  margin:0 auto 16px;box-shadow:0 0 38px rgba(124,58,237,.2),0 0 0 1px rgba(124,58,237,.1);
  position:relative;overflow:hidden;}
#qrCanvas{display:block;border-radius:6px;}
.scan-line{position:absolute;left:10px;right:10px;height:2px;
  background:linear-gradient(90deg,transparent,rgba(124,58,237,.7),transparent);
  animation:scan 2.2s ease-in-out infinite;}
@keyframes scan{0%,100%{top:13px;opacity:0}10%{opacity:1}90%{opacity:1}50%{top:calc(100% - 13px)}}

.divider{display:flex;align-items:center;gap:10px;margin:14px 0;
  color:var(--text3);font-family:'Space Mono',monospace;font-size:.65rem;}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border);}

.code-display{background:var(--bg3);border:1px solid var(--border2);border-radius:12px;
  padding:12px 15px;display:flex;align-items:center;justify-content:space-between;
  gap:10px;margin-bottom:12px;}
.code-text{font-family:'Space Mono',monospace;font-size:clamp(.88rem,3.5vw,1.05rem);
  font-weight:700;letter-spacing:.1em;color:var(--accent3);word-break:break-all;
  -webkit-user-select:text;user-select:text;}
.copy-btn{background:rgba(124,58,237,.13);border:1px solid rgba(124,58,237,.28);
  color:var(--accent3);border-radius:8px;padding:6px 11px;
  font-family:'Space Mono',monospace;font-size:.6rem;cursor:pointer;
  transition:all .2s;white-space:nowrap;-webkit-tap-highlight-color:transparent;min-height:34px;}
.copy-btn.copied{background:rgba(34,197,94,.12);border-color:rgba(34,197,94,.28);color:var(--green);}

.timer-bar{height:2px;background:var(--border);border-radius:2px;overflow:hidden;margin-bottom:6px;}
.timer-fill{height:100%;border-radius:2px;transition:width 1s linear,background 1s;}
.timer-text{font-family:'Space Mono',monospace;font-size:.63rem;color:var(--text3);text-align:center;margin-bottom:14px;}
.timer-text span{color:var(--text2);}
.waiting{display:flex;align-items:center;justify-content:center;gap:8px;color:var(--text2);font-size:.82rem;}
.dot-pulse{display:flex;gap:4px;}
.dot-pulse span{width:5px;height:5px;border-radius:50%;background:var(--accent2);animation:pulse 1.4s ease-in-out infinite;}
.dot-pulse span:nth-child(2){animation-delay:.2s}.dot-pulse span:nth-child(3){animation-delay:.4s}
@keyframes pulse{0%,80%,100%{transform:scale(.6);opacity:.35}40%{transform:scale(1);opacity:1}}

/* INPUTS */
.input-label{font-family:'Space Mono',monospace;font-size:.6rem;color:var(--text3);
  letter-spacing:.1em;text-transform:uppercase;margin-bottom:7px;}
.input-field{width:100%;background:var(--bg3);border:1px solid var(--border2);border-radius:12px;
  padding:14px 15px;font-family:'Space Mono',monospace;
  font-size:clamp(.98rem,3.8vw,1.1rem);font-weight:700;color:var(--text);
  outline:none;transition:border-color .2s,box-shadow .2s;
  letter-spacing:.09em;text-transform:uppercase;}
.input-field::placeholder{color:var(--text3);font-weight:400;letter-spacing:.05em;text-transform:none;}
.input-field:focus{border-color:var(--accent2);box-shadow:0 0 0 3px rgba(124,58,237,.1);}
.error-msg{font-family:'Space Mono',monospace;font-size:.66rem;color:var(--red);margin-top:7px;min-height:16px;}

/* PASSPHRASE */
.pw-input{width:100%;background:var(--bg3);border:1px solid var(--border2);border-radius:12px;
  padding:14px 15px;font-family:'Space Mono',monospace;font-size:1rem;color:var(--text);
  outline:none;letter-spacing:.07em;transition:border-color .2s,box-shadow .2s;}
.pw-input:focus{border-color:var(--accent2);box-shadow:0 0 0 3px rgba(124,58,237,.1);}
.pw-info{font-family:'Space Mono',monospace;font-size:.62rem;color:var(--text3);
  line-height:1.65;margin-bottom:14px;padding:12px;background:var(--bg3);
  border:1px solid var(--border);border-radius:10px;}
.pw-info .hi{color:var(--amber);}
.pw-strength-bar{height:3px;border-radius:2px;margin-top:8px;transition:all .3s;width:0%;}
.pw-strength-label{font-family:'Space Mono',monospace;font-size:.6rem;margin-top:5px;margin-bottom:16px;}

/* CHAT SCREEN */
#chatScreen{padding:0;align-items:stretch;overflow:hidden;}
.chat-outer{display:flex;flex-direction:column;width:100%;height:100%;max-width:680px;margin:0 auto;}
.chat-header{display:flex;align-items:center;gap:11px;
  padding:calc(var(--sat) + 12px) calc(var(--sar) + 16px) 12px calc(var(--sal) + 16px);
  border-bottom:1px solid var(--border);background:rgba(8,8,15,.94);
  backdrop-filter:blur(24px) saturate(1.5);-webkit-backdrop-filter:blur(24px) saturate(1.5);
  flex-shrink:0;z-index:5;}
.status-dot{width:8px;height:8px;border-radius:50%;background:var(--green);
  box-shadow:0 0 7px var(--green);flex-shrink:0;animation:sPulse 2.2s ease-in-out infinite;}
@keyframes sPulse{0%,100%{box-shadow:0 0 5px var(--green)}50%{box-shadow:0 0 13px var(--green2)}}
.chat-info{flex:1;min-width:0;}
.chat-info h3{font-size:clamp(.86rem,3.4vw,.93rem);font-weight:700;
  display:flex;align-items:center;gap:7px;white-space:nowrap;overflow:hidden;}
.e2e-badge{font-family:'Space Mono',monospace;font-size:.5rem;padding:2px 6px;border-radius:4px;
  background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.22);color:var(--green);
  letter-spacing:.05em;flex-shrink:0;}
.chat-info p{font-family:'Space Mono',monospace;font-size:.58rem;color:var(--text3);margin-top:2px;}
.chat-actions{display:flex;gap:6px;}
.icon-btn{width:38px;height:38px;border-radius:10px;border:1px solid var(--border);
  background:transparent;color:var(--text3);cursor:pointer;display:flex;align-items:center;
  justify-content:center;transition:all .18s;-webkit-tap-highlight-color:transparent;font-size:.9rem;}
.icon-btn:active{background:var(--bg3);}

/* Inactivity bar */
.inactivity-bar{background:rgba(245,158,11,.07);border-bottom:1px solid rgba(245,158,11,.18);
  padding:7px 16px;display:flex;align-items:center;justify-content:space-between;gap:10px;
  flex-shrink:0;transform:translateY(-100%);transition:transform .25s ease;}
.inactivity-bar.visible{transform:translateY(0);}
.inactivity-bar span{font-family:'Space Mono',monospace;font-size:.6rem;color:var(--amber);}
.inactivity-bar button{font-family:'Space Mono',monospace;font-size:.58rem;
  background:rgba(245,158,11,.12);border:1px solid rgba(245,158,11,.25);
  color:var(--amber);border-radius:6px;padding:4px 10px;cursor:pointer;min-height:30px;
  -webkit-tap-highlight-color:transparent;}

/* Messages */
.messages-area{flex:1;overflow-y:auto;padding:14px 14px 8px;
  display:flex;flex-direction:column;gap:10px;scroll-behavior:smooth;
  -webkit-overflow-scrolling:touch;overscroll-behavior:contain;}
.messages-area::-webkit-scrollbar{width:3px;}
.messages-area::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}
.msg{max-width:min(74%,340px);animation:mIn .25s ease;}
@keyframes mIn{from{opacity:0;transform:translateY(7px)}to{opacity:1;transform:translateY(0)}}
.msg.mine{align-self:flex-end;}.msg.theirs{align-self:flex-start;}
.msg-bubble{padding:10px 14px;border-radius:17px;font-size:clamp(.87rem,3.5vw,.95rem);
  line-height:1.5;word-break:break-word;-webkit-user-select:text;user-select:text;}
.msg.mine .msg-bubble{background:linear-gradient(135deg,var(--accent),#6d28d9);color:#fff;
  border-bottom-right-radius:4px;box-shadow:0 2px 9px rgba(124,58,237,.22);}
.msg.theirs .msg-bubble{background:var(--bg3);color:var(--text);
  border-bottom-left-radius:4px;border:1px solid var(--border2);}
.msg-destruct-bar{height:2px;background:var(--border);border-radius:1px;margin-top:4px;overflow:hidden;}
.msg-destruct-fill{height:100%;background:var(--red);border-radius:1px;transition:width 1s linear;}
.msg-meta{font-family:'Space Mono',monospace;font-size:.56rem;color:var(--text3);
  margin-top:4px;display:flex;align-items:center;gap:5px;}
.msg.mine .msg-meta{justify-content:flex-end;}
.lock-ico{font-size:.5rem;color:var(--green);}
.system-msg{text-align:center;font-family:'Space Mono',monospace;font-size:.6rem;
  color:var(--text3);padding:5px 14px;background:var(--bg3);
  border:1px solid var(--border);border-radius:20px;align-self:center;max-width:86%;line-height:1.45;}

/* Chat input */
.chat-input-area{padding:8px calc(var(--sar) + 13px) calc(var(--sab) + 9px) calc(var(--sal) + 13px);
  border-top:1px solid var(--border);background:rgba(8,8,15,.94);
  backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);flex-shrink:0;}
.input-toolbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:7px;gap:8px;}
.destruct-toggle{display:flex;align-items:center;gap:6px;cursor:pointer;-webkit-tap-highlight-color:transparent;}
.toggle-track{width:34px;height:18px;border-radius:9px;background:var(--bg4);
  border:1px solid var(--border2);position:relative;transition:background .2s;flex-shrink:0;}
.toggle-thumb{width:12px;height:12px;border-radius:50%;background:var(--text3);
  position:absolute;top:2px;left:2px;transition:all .2s;}
.destruct-toggle.on .toggle-track{background:rgba(239,68,68,.15);border-color:rgba(239,68,68,.3);}
.destruct-toggle.on .toggle-thumb{left:18px;background:var(--red);}
.destruct-label{font-family:'Space Mono',monospace;font-size:.58rem;color:var(--text3);}
.destruct-toggle.on .destruct-label{color:var(--red);}
.timer-select{background:var(--bg4);border:1px solid var(--border2);border-radius:7px;
  color:var(--text2);font-family:'Space Mono',monospace;font-size:.58rem;
  padding:3px 7px;outline:none;cursor:pointer;display:none;}
.encrypt-status{font-family:'Space Mono',monospace;font-size:.56rem;color:var(--green);
  display:flex;align-items:center;gap:4px;}
.input-row{display:flex;gap:9px;align-items:flex-end;}
.message-input{flex:1;background:var(--bg3);border:1px solid var(--border2);border-radius:14px;
  padding:12px 14px;font-family:'Syne',sans-serif;font-size:clamp(.9rem,3.5vw,1rem);
  color:var(--text);outline:none;resize:none;min-height:46px;max-height:130px;
  transition:border-color .2s;line-height:1.4;}
.message-input::placeholder{color:var(--text3);}
.message-input:focus{border-color:var(--accent2);}
.send-btn{width:46px;height:46px;border-radius:14px;flex-shrink:0;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;
  color:#fff;font-size:1.15rem;transition:all .18s;
  box-shadow:0 0 16px rgba(124,58,237,.22);-webkit-tap-highlight-color:transparent;}
.send-btn:active{transform:scale(.95);}
.send-btn:disabled{opacity:.35;cursor:not-allowed;}

/* Blur overlay */
.blur-overlay{position:fixed;inset:0;z-index:9998;background:rgba(8,8,15,.97);
  backdrop-filter:blur(30px);-webkit-backdrop-filter:blur(30px);
  display:flex;align-items:center;justify-content:center;flex-direction:column;gap:14px;
  opacity:0;pointer-events:none;
  /* NO transition ‚Äî must be instant for iOS app-switcher screenshot */}
.blur-overlay.active{opacity:1;pointer-events:all;}
.blur-overlay h3{font-size:1.05rem;font-weight:700;text-align:center;}
.blur-overlay p{font-family:'Space Mono',monospace;font-size:.66rem;color:var(--text3);
  text-align:center;max-width:240px;line-height:1.55;}

/* Modal */
.modal-overlay{position:fixed;inset:0;z-index:300;background:rgba(0,0,0,.72);
  backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
  display:flex;align-items:center;justify-content:center;padding:20px;
  opacity:0;pointer-events:none;transition:opacity .25s;}
.modal-overlay.active{opacity:1;pointer-events:all;}
.modal{background:var(--bg2);border:1px solid var(--border2);border-radius:20px;
  padding:26px;width:100%;max-width:380px;animation:mIn .25s ease;
  max-height:90vh;overflow-y:auto;}
.modal h3{font-size:1.05rem;font-weight:700;margin-bottom:5px;}
.modal p{font-family:'Space Mono',monospace;font-size:.64rem;color:var(--text3);line-height:1.6;margin-bottom:14px;}
.fp-grid{font-family:'Space Mono',monospace;font-size:.6rem;color:var(--text2);
  background:var(--bg3);border:1px solid var(--border);border-radius:10px;
  padding:12px;word-break:break-all;line-height:1.8;margin-bottom:14px;letter-spacing:.04em;}
.fp-label{color:var(--text3);font-size:.54rem;text-transform:uppercase;letter-spacing:.1em;
  margin-bottom:4px;display:block;}

/* Destroyed */
#destroyedScreen{flex-direction:column;text-align:center;gap:14px;}
.destroy-icon{font-size:2.8rem;}
.destroy-title{font-size:1.4rem;font-weight:800;}
.destroy-sub{font-family:'Space Mono',monospace;font-size:.68rem;color:var(--text3);
  max-width:270px;line-height:1.7;}

/* Toast */
.toast{position:fixed;bottom:calc(var(--sab) + 18px);left:50%;
  transform:translateX(-50%) translateY(70px);background:var(--bg3);
  border:1px solid var(--border2);border-radius:10px;padding:9px 18px;
  font-family:'Space Mono',monospace;font-size:.7rem;color:var(--text);
  z-index:999;transition:transform .28s ease;white-space:nowrap;pointer-events:none;}
.toast.show{transform:translateX(-50%) translateY(0);}
.toast.green{border-color:rgba(34,197,94,.3);color:var(--green);}
.toast.red{border-color:rgba(239,68,68,.3);color:var(--red);}
.toast.amber{border-color:rgba(245,158,11,.3);color:var(--amber);}

.spinner{width:28px;height:28px;border:2px solid var(--border2);border-top-color:var(--accent2);
  border-radius:50%;animation:spinRing .75s linear infinite;}
.connecting-overlay{position:absolute;inset:0;z-index:5;border-radius:22px;
  background:rgba(8,8,15,.9);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;}
.connecting-overlay.hidden{display:none;}
.connecting-overlay p{font-family:'Space Mono',monospace;font-size:.7rem;color:var(--text2);}
</style>
</head>
<body>

<!-- HOME -->
<div id="homeScreen" class="screen">
  <div class="screen-inner">
    <div class="logo-wrap">
      <div class="logo-svg-container">
        <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="32" cy="32" r="29" stroke="rgba(124,58,237,.18)" stroke-width="1"/>
          <circle cx="32" cy="32" r="20" stroke="rgba(124,58,237,.09)" stroke-width="1" stroke-dasharray="4 3"/>
          <g class="logo-ring">
            <circle cx="32" cy="3" r="3.5" fill="#7c3aed"/>
            <circle cx="61" cy="32" r="2.2" fill="#a855f7" opacity=".6"/>
            <circle cx="32" cy="61" r="2" fill="#a855f7" opacity=".35"/>
            <circle cx="3" cy="32" r="1.5" fill="#c084fc" opacity=".25"/>
            <line x1="32" y1="6.5" x2="32" y2="12" stroke="rgba(124,58,237,.35)" stroke-width=".8"/>
            <line x1="58.8" y1="32" x2="52" y2="32" stroke="rgba(124,58,237,.2)" stroke-width=".8"/>
          </g>
          <path d="M32 16 L42 21 L42 30 C42 36.5 37 42 32 44 C27 42 22 36.5 22 30 L22 21 Z"
            fill="none" stroke="rgba(255,255,255,.14)" stroke-width="1.2"/>
          <rect x="27" y="31" width="10" height="8" rx="2" fill="none" stroke="white" stroke-width="1.3" opacity=".82"/>
          <path d="M29 31 L29 28.5 C29 26.5 35 26.5 35 28.5 L35 31"
            fill="none" stroke="white" stroke-width="1.3" stroke-linecap="round" opacity=".82"/>
          <circle cx="32" cy="34.5" r="1.2" fill="white" opacity=".7"/>
          <rect x="31.3" y="35.5" width="1.4" height="2" rx=".5" fill="white" opacity=".7"/>
        </svg>
      </div>
      <h1>Phantom</h1>
      <p class="tagline">Zero-knowledge ¬∑ End-to-end encrypted</p>
    </div>
    <div class="home-actions" style="width:100%">
      <button class="btn btn-primary" onclick="showCreateFlow()">üîê &nbsp;New Encrypted Chat</button>
      <button class="btn btn-secondary" onclick="showConnectFlow()">üîó &nbsp;Join with Code</button>
    </div>
    <div class="badges">
      <span class="badge green">E2E Encrypted</span>
      <span class="badge green">AES-256-GCM</span>
      <span class="badge green">Forward Secrecy</span>
      <span class="badge">Zero Logs</span>
      <span class="badge">No Account</span>
      <span class="badge amber">PW-Protected Keys</span>
      <span class="badge amber">Auto-Wipe</span>
      <span class="badge amber">Anti-Forensic</span>
    </div>
  </div>
</div>

<!-- PASSPHRASE SCREEN -->
<div id="passphraseScreen" class="screen hidden">
  <div class="screen-inner">
    <div class="card">
      <div class="card-title">üõ°Ô∏è Protect Your Keys</div>
      <div class="card-sub">Required before starting. Never stored or transmitted.</div>
      <div class="pw-info">
        <span class="hi">Why this matters:</span> Your session keys are only held in RAM. If your device is stolen mid-session, a passphrase means keys cannot be recovered even via memory forensics or cold-boot attack ‚Äî they are wrapped under PBKDF2-SHA256 (310,000 rounds).
      </div>
      <div class="input-label">Passphrase</div>
      <input type="password" class="pw-input" id="passphraseInput"
        placeholder="Enter a strong passphrase‚Ä¶"
        autocomplete="new-password"
        autocorrect="off"
        autocapitalize="off"
        spellcheck="false"
        data-gramm="false"
        onkeyup="checkPwStrength(this.value)"
        onkeydown="if(event.key==='Enter')confirmPassphrase()">
      <div class="pw-strength-bar" id="pwBar"></div>
      <div class="pw-strength-label" id="pwLabel" style="color:var(--text3)">Enter passphrase above</div>
      <button class="btn btn-primary" id="pwBtn" onclick="confirmPassphrase()" style="width:100%;margin-bottom:10px" disabled>
        üîë Confirm & Continue
      </button>
      <button class="btn btn-ghost" onclick="showHome()" style="width:100%">‚Üê Back</button>
    </div>
  </div>
</div>

<!-- CREATE SCREEN -->
<div id="createScreen" class="screen hidden">
  <div class="screen-inner">
    <div class="card" style="position:relative">
      <div id="connectingOverlay" class="connecting-overlay hidden">
        <div class="spinner"></div>
        <p>Establishing encrypted session‚Ä¶</p>
      </div>
      <div class="card-title">New Chat</div>
      <div class="card-sub">Share with your contact ¬∑ Single-use ¬∑ Expires in 5 min</div>
      <div class="qr-wrapper">
        <canvas id="qrCanvas"></canvas>
        <div class="scan-line"></div>
      </div>
      <div class="divider">or share code</div>
      <div class="code-display">
        <div class="code-text" id="chatCode">‚Äî</div>
        <button class="copy-btn" id="copyBtn" onclick="copyCode()">COPY</button>
      </div>
      <div class="timer-bar"><div class="timer-fill" id="timerFill" style="width:100%"></div></div>
      <div class="timer-text">Expires in <span id="timerSec">5:00</span></div>
      <div id="relayStatus" style="font-family:'Space Mono',monospace;font-size:.62rem;color:var(--text3);text-align:center;margin-bottom:8px;padding:6px 12px;border-radius:8px;background:var(--bg3);border:1px solid var(--border)">
        ‚è≥ Connecting to relay‚Ä¶
      </div>
      <div class="waiting">Waiting for contact to join
        <div class="dot-pulse"><span></span><span></span><span></span></div>
      </div>
      <div style="margin-top:16px">
        <button class="btn btn-ghost" onclick="cancelCreate()" style="width:100%">‚Üê Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- CONNECT SCREEN -->
<div id="connectScreen" class="screen hidden">
  <div class="screen-inner">
    <div class="card">
      <div class="card-title">Join Chat</div>
      <div class="card-sub">Enter the code shared by your contact</div>
      <div class="input-label">Session Code</div>
      <input type="text" class="input-field" id="connectCodeInput"
        placeholder="XXXX-XXXX-XXXX-XXXX" maxlength="19"
        autocomplete="off"
        autocorrect="off"
        autocapitalize="characters"
        spellcheck="false"
        inputmode="text"
        oninput="formatCodeInput(this)"
        onkeydown="if(event.key==='Enter')connectToChat()">
      <div class="error-msg" id="connectError"></div>
      <button class="btn btn-primary" onclick="connectToChat()" style="width:100%;margin-top:14px;margin-bottom:10px" id="connectBtn">
        üîê Connect Securely
      </button>
      <button class="btn btn-ghost" onclick="showHome()" style="width:100%">‚Üê Back</button>
    </div>
  </div>
</div>

<!-- CHAT SCREEN -->
<div id="chatScreen" class="screen hidden">
  <div class="chat-outer">
    <div class="chat-header">
      <div class="status-dot"></div>
      <div class="chat-info">
        <h3>Anonymous Chat <span class="e2e-badge">E2E</span></h3>
        <p id="chatHeaderSub">AES-256-GCM ¬∑ Session active</p>
      </div>
      <div class="chat-actions">
        <button class="icon-btn" onclick="showSessionInfo()" title="Session info">üîë</button>
        <button class="icon-btn" onclick="endChat()" title="End session" style="color:var(--red)">‚úï</button>
      </div>
    </div>
    <div class="inactivity-bar" id="inactivityBar">
      <span>‚ö† Auto-wipe in <span id="inactivityCountdown">60</span>s</span>
      <button onclick="resetInactivity()">I'm Here</button>
    </div>
    <div class="messages-area" id="messagesArea" oncontextmenu="return false">
      <div class="system-msg">üîê Encrypted session active ¬∑ ECDH P-256 + AES-256-GCM<br>Keys never leave this device</div>
    </div>
    <div class="chat-input-area">
      <div class="input-toolbar">
        <div class="encrypt-status">üîí Encrypted before sending</div>
        <div style="display:flex;align-items:center;gap:8px">
          <div class="destruct-toggle" id="destructToggle" onclick="toggleDestruct()">
            <div class="toggle-track"><div class="toggle-thumb"></div></div>
            <span class="destruct-label">üí£ Self-destruct</span>
          </div>
          <select class="timer-select" id="destructTimer">
            <option value="10">10s</option>
            <option value="30" selected>30s</option>
            <option value="60">60s</option>
            <option value="300">5m</option>
          </select>
        </div>
      </div>
      <div class="input-row">
        <textarea class="message-input" id="messageInput"
          placeholder="Type a message‚Ä¶" rows="1" maxlength="2000"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
          data-gramm="false"
          data-gramm_editor="false"
          data-enable-grammarly="false"
          onkeydown="handleMsgKey(event)"
          oninput="onMsgInput(this)"
          onfocus="resetInactivity()"
        ></textarea>
        <button class="send-btn" id="sendBtn" onclick="sendMessage()">‚Üë</button>
      </div>
    </div>
  </div>
</div>

<!-- DESTROYED SCREEN -->
<div id="destroyedScreen" class="screen hidden">
  <div class="screen-inner" style="text-align:center;gap:14px">
    <div class="destroy-icon">üî•</div>
    <div class="destroy-title">Session Destroyed</div>
    <div class="destroy-sub" id="destroyReason">All keys erased from memory.<br>Messages gone permanently.<br>No trace remains on this device.</div>
    <button class="btn btn-secondary" onclick="showHome()" style="margin-top:8px;width:100%;max-width:260px">New Session</button>
  </div>
</div>

<!-- BLUR OVERLAY -->
<div class="blur-overlay" id="blurOverlay">
  <div style="font-size:2rem">üôà</div>
  <h3>Screen Protected</h3>
  <p>Chat is hidden to prevent app-switcher previews and shoulder-surfing.</p>
  <button class="btn btn-secondary" onclick="dismissBlur()" style="margin-top:8px">Reveal Chat</button>
</div>

<!-- SESSION INFO MODAL -->
<div class="modal-overlay" id="sessionModal" onclick="if(event.target===this)closeModal('sessionModal')">
  <div class="modal">
    <h3>üîë Session Security</h3>
    <p>Verify this fingerprint with your contact out-of-band to rule out a man-in-the-middle attack.</p>
    <div class="fp-grid">
      <span class="fp-label">Session Fingerprint (SHA-256)</span>
      <span id="fingerprintDisplay">‚Äî</span>
    </div>
    <div class="fp-grid">
      <span class="fp-label">Encryption Details</span>
      Key Exchange: ECDH P-256 (HKDF-SHA256)<br>
      Cipher: AES-256-GCM<br>
      Key Wrap: PBKDF2-SHA256 (310k rounds)<br>
      Nonce: 96-bit random per message<br>
      Padding: msg length hidden<br>
      Forward Secrecy: ‚úì<br>
      Keyboard Cache: Disabled<br>
      Auto-Wipe: 5min inactivity<br>
      Persistence: RAM only
    </div>
    <button class="btn btn-ghost" onclick="closeModal('sessionModal')" style="width:100%">Close</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
'use strict';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CRYPTO ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const Crypto = (() => {
  const sub = crypto.subtle;

  async function generateKeyPair() {
    return sub.generateKey({ name:'ECDH', namedCurve:'P-256' }, true, ['deriveKey','deriveBits']);
  }
  async function exportPublicKey(k) {
    return bufB64(await sub.exportKey('raw', k));
  }
  async function importPublicKey(b64) {
    return sub.importKey('raw', b64Buf(b64), { name:'ECDH', namedCurve:'P-256' }, true, []);
  }

  // ECDH ‚Üí HKDF ‚Üí AES-256-GCM shared key
  async function deriveSharedKey(priv, pub) {
    const bits = await sub.deriveBits({ name:'ECDH', public:pub }, priv, 256);
    const hkdf = await sub.importKey('raw', bits, 'HKDF', false, ['deriveKey']);
    return sub.deriveKey(
      { name:'HKDF', hash:'SHA-256', salt: new Uint8Array(32),
        info: new TextEncoder().encode('phantom-msg-v1') },
      hkdf, { name:'AES-GCM', length:256 }, false, ['encrypt','decrypt']
    );
  }

  // Password key (PBKDF2, 310k rounds)
  async function deriveKeyFromPassword(pw, salt) {
    const raw = await sub.importKey('raw', new TextEncoder().encode(pw), 'PBKDF2', false, ['deriveKey']);
    return sub.deriveKey(
      { name:'PBKDF2', hash:'SHA-256', salt, iterations:310000 },
      raw, { name:'AES-GCM', length:256 }, false, ['encrypt','decrypt']
    );
  }

  // Encrypt message. Pads to hide length.
  async function encrypt(key, plaintext) {
    const iv = crypto.getRandomValues(new Uint8Array(12));
    const enc = new TextEncoder().encode(plaintext);
    // Pad to next multiple of 64 bytes
    const pad = 64 - (enc.length % 64);
    const padded = new Uint8Array(enc.length + pad);
    padded.set(enc);
    padded[enc.length] = 0x80; // PKCS-style marker
    const ct = await sub.encrypt({ name:'AES-GCM', iv }, key, padded);
    return { c: bufB64(ct), iv: bufB64(iv), l: enc.length };
  }

  async function decrypt(key, obj) {
    const iv = b64Buf(obj.iv);
    const ct = b64Buf(obj.c);
    const padded = await sub.decrypt({ name:'AES-GCM', iv }, key, ct);
    return new TextDecoder().decode(new Uint8Array(padded).slice(0, obj.l));
  }

  function generateCode() {
    const a = 'ABCDEFGHJKMNPQRSTUVWXYZ23456789'; // no ambiguous O/0/I/1/L
    const b = crypto.getRandomValues(new Uint8Array(24));
    let s = '';
    for (const x of b) { if (s.length < 16) s += a[x % a.length]; }
    return s.match(/.{4}/g).join('-');
  }

  async function fingerprint(pubB64) {
    const data = new TextEncoder().encode('phantom-fp-v1:' + pubB64);
    const h = await sub.digest('SHA-256', data);
    const hex = [...new Uint8Array(h)].map(x => x.toString(16).padStart(2,'0')).join('');
    return hex.slice(0,40).match(/.{4}/g).join(' ').toUpperCase();
  }

  const bufB64 = b => btoa(String.fromCharCode(...new Uint8Array(b)));
  const b64Buf = b => Uint8Array.from(atob(b), c => c.charCodeAt(0)).buffer;

  return { generateKeyPair, exportPublicKey, importPublicKey, deriveSharedKey,
           deriveKeyFromPassword, encrypt, decrypt, generateCode, fingerprint };
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SESSION STATE ‚Äî memory only, never stored
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let S = {
  role: null, myKeyPair: null, sharedKey: null,
  code: null, passphrase: null, fingerprint: null,
  messageCount: 0, bc: null
};
let pendingRole = null;
let destructEnabled = false;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INACTIVITY AUTO-WIPE (warn at 4 min, wipe at 5 min)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let inactivityTimer = null, inactivitySeconds = 0;
const WARN_AT = 240, WIPE_AT = 300;

function startInactivityTimer() {
  stopInactivityTimer();
  inactivitySeconds = 0;
  document.getElementById('inactivityBar').classList.remove('visible');
  inactivityTimer = setInterval(() => {
    inactivitySeconds++;
    if (inactivitySeconds >= WIPE_AT) {
      stopInactivityTimer();
      autoWipe();
    } else if (inactivitySeconds >= WARN_AT) {
      const left = WIPE_AT - inactivitySeconds;
      document.getElementById('inactivityCountdown').textContent = left;
      document.getElementById('inactivityBar').classList.add('visible');
    }
  }, 1000);
}

function stopInactivityTimer() {
  clearInterval(inactivityTimer); inactivityTimer = null;
}

function resetInactivity() {
  inactivitySeconds = 0;
  document.getElementById('inactivityBar').classList.remove('visible');
}

function autoWipe() {
  if (S.bc) { S.bc.shutdown(true); S.bc = null; }
  destroySession('Auto-wiped: inactivity timeout reached.\nAll keys and messages destroyed.');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BLUR / SCREEN PROTECTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚îÄ‚îÄ Privacy screen ‚Äî show blur BEFORE iOS takes app-switcher screenshot
// iOS fires events in this order when user swipes up to app switcher:
//   1. window 'blur'        ‚Üê fires FIRST, before screenshot ‚Äî use this
//   2. document 'visibilitychange' (hidden) ‚Üê sometimes after screenshot
//   3. window 'pagehide'   ‚Üê fires when fully backgrounded
//
// Android fires visibilitychange fast enough. We cover both.

function showPrivacyScreen() {
  if (!S.sharedKey) return;   // only protect active sessions
  document.getElementById('blurOverlay').classList.add('active');
  document.title = 'Phantom'; // hide any title bar content
}

// window blur ‚Äî the CRITICAL one for iOS app switcher screenshots
window.addEventListener('blur', showPrivacyScreen);

// visibilitychange ‚Äî catches Android + desktop tab switching
document.addEventListener('visibilitychange', () => {
  if (document.hidden) showPrivacyScreen();
});

// pagehide ‚Äî belt-and-braces for iOS background/kill
window.addEventListener('pagehide', showPrivacyScreen);

function dismissBlur() {
  document.getElementById('blurOverlay').classList.remove('active');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PASSPHRASE SCREEN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showCreateFlow() { pendingRole = 'creator'; showScreen('passphraseScreen'); setTimeout(() => document.getElementById('passphraseInput').focus(), 350); }
function showConnectFlow() { pendingRole = 'joiner'; showScreen('passphraseScreen'); setTimeout(() => document.getElementById('passphraseInput').focus(), 350); }

function checkPwStrength(pw) {
  let sc = 0;
  if (pw.length >= 8) sc++;
  if (pw.length >= 14) sc++;
  if (/[A-Z]/.test(pw) && /[a-z]/.test(pw)) sc++;
  if (/[0-9]/.test(pw)) sc++;
  if (/[^A-Za-z0-9]/.test(pw)) sc++;
  const cfgs = [
    { w:'0%', c:'var(--border)', l:'Enter passphrase above', ok:false },
    { w:'20%', c:'var(--red)', l:'Too weak', ok:false },
    { w:'40%', c:'#f97316', l:'Weak', ok:false },
    { w:'60%', c:'var(--amber)', l:'Moderate ‚Äî acceptable', ok:true },
    { w:'80%', c:'#84cc16', l:'Strong', ok:true },
    { w:'100%', c:'var(--green)', l:'Very strong ‚úì', ok:true },
  ];
  const c = cfgs[Math.min(sc, 5)];
  const bar = document.getElementById('pwBar');
  bar.style.width = c.w; bar.style.background = c.c;
  const lbl = document.getElementById('pwLabel');
  lbl.textContent = pw.length === 0 ? cfgs[0].l : c.l;
  lbl.style.color = c.c;
  document.getElementById('pwBtn').disabled = !c.ok;
}

async function confirmPassphrase() {
  const pw = document.getElementById('passphraseInput').value;
  if (!pw || pw.length < 6) return;
  S.passphrase = pw;
  // Immediately clear input field from DOM
  document.getElementById('passphraseInput').value = '';
  document.getElementById('pwBar').style.width = '0%';
  document.getElementById('pwLabel').textContent = 'Enter passphrase above';
  document.getElementById('pwBtn').disabled = true;
  if (pendingRole === 'creator') {
    await initCreateSession();
    // initCreateSession calls showHome() itself on relay failure, so only
    // advance to createScreen if we still have a valid session code
    if (S.code) showScreen('createScreen');
  }
  else { showScreen('connectScreen'); setTimeout(() => document.getElementById('connectCodeInput').focus(), 350); }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RELAY URL ‚Äî change this to your Deno Deploy URL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Get a FREE relay in 2 minutes:
//   1. Go to https://dash.deno.com ‚Üí New Playground
//   2. Paste phantom-relay-deno.ts ‚Üí Save & Deploy
//   3. Change the URL below to wss://your-relay.deno.dev
//
// WHY NOT CLOUDFLARE WORKERS: Workers are multi-instance ‚Äî creator
// and joiner land on different server instances with separate memory,
// so messages never relay. Deno Deploy runs as one process.
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const RELAY_URL = 'https://epic-oyster-81.phantomweb.deno.net/';
//                ‚Üë Replace with your Deno Deploy wss:// URL

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// openTransport ‚Äî returns a confirmed-open transport object
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openTransport(sessionCode, onMessage) {
  return new Promise((resolve, reject) => {

    if (!RELAY_URL) {
      // DEMO MODE: BroadcastChannel (same browser/device only)
      const bc = new BroadcastChannel('ph_' + sessionCode);
      bc.onmessage = (e) => onMessage(e.data);
      bc.tx       = (obj) => bc.postMessage(obj);
      bc.shutdown  = (sendEnd) => {
        if (sendEnd) try { bc.postMessage({ type:'end' }); } catch(e) {}
        bc.close();
      };
      return resolve(bc);
    }

    // REAL MODE: WebSocket relay
    let settled = false;
    const ws = new WebSocket(`${RELAY_URL}?s=${encodeURIComponent(sessionCode)}`);

    // 8-second connection timeout
    const timeout = setTimeout(() => {
      if (!settled) {
        settled = true;
        ws.close();
        reject(new Error('Connection timed out ‚Äî relay may be down'));
      }
    }, 8000);

    ws.onopen = () => {
      clearTimeout(timeout);
      if (!settled) {
        settled = true;
        // Flush any messages that queued before open
        (ws._q || []).forEach(m => ws.send(m));
        ws._q = [];
        resolve(ws);
      }
    };

    ws.onerror = (ev) => {
      clearTimeout(timeout);
      if (!settled) {
        settled = true;
        reject(new Error('WebSocket error ‚Äî cannot reach relay'));
      }
    };

    ws.onmessage = (e) => {
      try { onMessage(JSON.parse(e.data)); } catch(_) {}
    };

    ws.onclose = (e) => {
      clearTimeout(timeout);
      // Only alert user if session was active AND it wasn't us who closed it
      if (S.sharedKey && e.code !== 4000) {
        showToast('Relay disconnected', 'amber');
      }
      // If we got a 4003 (session full), tell the user clearly
      if (e.code === 4003) {
        document.getElementById('connectError').textContent =
          'Session full ‚Äî code already in use by 2 parties.';
      }
    };

    // .tx() ‚Äî send JSON, queues until open
    ws.tx = (obj) => {
      const raw = JSON.stringify(obj);
      if (ws.readyState === WebSocket.OPEN) {
        ws.send(raw);
      } else {
        ws._q = ws._q || [];
        ws._q.push(raw);
      }
    };

    // .shutdown() ‚Äî optionally send 'end' then close cleanly
    ws.shutdown = (sendEnd) => {
      if (sendEnd && ws.readyState === WebSocket.OPEN) {
        try { ws.send(JSON.stringify({ type:'end' })); } catch(_) {}
      }
      ws.close(4000, 'session ended');
    };
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CREATE SESSION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let timerInterval = null, timerSeconds = 300;

async function initCreateSession() {
  S.role = 'creator';
  S.myKeyPair = await Crypto.generateKeyPair();
  const pubB64 = await Crypto.exportPublicKey(S.myKeyPair.publicKey);
  S.code = Crypto.generateCode();
  S.fingerprint = await Crypto.fingerprint(pubB64);

  drawQR(JSON.stringify({ v:1, code: S.code, pk: pubB64 }));
  document.getElementById('chatCode').textContent = S.code;
  startTimer();

  if (S.bc) S.bc.shutdown(false);
  try {
    S.bc = await openTransport(S.code, async (data) => {
      const { type } = data;
      if (type === 'handshake') await creatorHandshake(data);
      else if (type === 'message') receiveMessage(data.p);
      else if (type === 'end') peerEnded();
    });
    // Relay connected ‚Äî update status indicator
    const rs = document.getElementById('relayStatus');
    if (rs) { rs.style.borderColor = 'rgba(34,197,94,.3)'; rs.style.color = 'var(--green)'; rs.textContent = '‚úì Relay connected ‚Äî share the code above'; }
  } catch(err) {
    clearInterval(timerInterval);
    const rs = document.getElementById('relayStatus');
    if (rs) { rs.style.borderColor = 'rgba(239,68,68,.3)'; rs.style.color = 'var(--red)'; rs.textContent = '‚úó Cannot reach relay: ' + err.message; }
    // Show error on screen for 4s then go home
    setTimeout(() => { S.code = null; showHome(); }, 4000);
    return;
  }
}

async function creatorHandshake(data) {
  clearInterval(timerInterval);
  document.getElementById('connectingOverlay').classList.remove('hidden');
  try {
    const jPub = await Crypto.importPublicKey(data.pk);
    S.sharedKey = await Crypto.deriveSharedKey(S.myKeyPair.privateKey, jPub);
    S.passphrase = null; // passphrase no longer needed in memory
    S.bc.tx({ type:'handshake_reply', pk: await Crypto.exportPublicKey(S.myKeyPair.publicKey) });
    setTimeout(openChat, 750);
  } catch(e) {
    document.getElementById('connectingOverlay').classList.add('hidden');
    showToast('Handshake failed', 'red');
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONNECT SESSION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function connectToChat() {
  const raw = document.getElementById('connectCodeInput').value.replace(/[^A-Za-z0-9]/g,'').toUpperCase();
  if (raw.length !== 16) { document.getElementById('connectError').textContent = 'Code must be 16 characters'; return; }
  const code = raw.match(/.{4}/g).join('-');
  document.getElementById('connectBtn').disabled = true;
  document.getElementById('connectBtn').textContent = 'Connecting‚Ä¶';
  document.getElementById('connectError').textContent = '';

  S.role = 'joiner'; S.code = code;
  S.myKeyPair = await Crypto.generateKeyPair();
  const pubB64 = await Crypto.exportPublicKey(S.myKeyPair.publicKey);
  S.fingerprint = await Crypto.fingerprint(pubB64);

  if (S.bc) S.bc.shutdown(false);
  try {
    S.bc = await openTransport(code, async (data) => {
      const { type } = data;
      if (type === 'handshake_reply') await joinerHandshake(data);
      else if (type === 'message') receiveMessage(data.p);
      else if (type === 'end') peerEnded();
    });
  } catch(err) {
    document.getElementById('connectBtn').disabled = false;
    document.getElementById('connectBtn').innerHTML = 'üîê Connect Securely';
    document.getElementById('connectError').textContent = 'Cannot reach relay server. Check your internet connection.';
    return;
  }
  S.bc.tx({ type:'handshake', pk: pubB64 });

  setTimeout(() => {
    if (!S.sharedKey) {
      document.getElementById('connectBtn').disabled = false;
      document.getElementById('connectBtn').innerHTML = 'üîê Connect Securely';
      document.getElementById('connectError').textContent = 'No response. Check code or ask them to regenerate.';
    }
  }, 12000);
}

async function joinerHandshake(data) {
  try {
    const cPub = await Crypto.importPublicKey(data.pk);
    S.sharedKey = await Crypto.deriveSharedKey(S.myKeyPair.privateKey, cPub);
    S.passphrase = null;
    setTimeout(openChat, 400);
  } catch(e) {
    document.getElementById('connectError').textContent = 'Failed to establish session.';
    document.getElementById('connectBtn').disabled = false;
    document.getElementById('connectBtn').innerHTML = 'üîê Connect Securely';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// OPEN CHAT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openChat() {
  document.getElementById('messagesArea').innerHTML =
    '<div class="system-msg">üîê Encrypted session active ¬∑ ECDH P-256 + AES-256-GCM<br>Keys never leave this device</div>';
  S.messageCount = 0;
  document.getElementById('chatHeaderSub').textContent =
    'AES-256-GCM ¬∑ ' + (S.role === 'creator' ? 'Initiator' : 'Joiner');
  showScreen('chatScreen');
  startInactivityTimer();
  setTimeout(() => document.getElementById('messageInput').focus(), 350);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MESSAGING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleDestruct() {
  destructEnabled = !destructEnabled;
  document.getElementById('destructToggle').classList.toggle('on', destructEnabled);
  document.getElementById('destructTimer').style.display = destructEnabled ? 'block' : 'none';
}

async function sendMessage() {
  const input = document.getElementById('messageInput');
  const text = input.value.trim();
  if (!text || !S.sharedKey) return;
  resetInactivity();
  const dSecs = destructEnabled ? parseInt(document.getElementById('destructTimer').value) : 0;
  // Clear input BEFORE async work (anti-forensic: keyboard history sees cleared field)
  input.value = '';
  input.style.height = 'auto';
  const enc = await Crypto.encrypt(S.sharedKey, text);
  if (dSecs) enc.d = dSecs;
  addMessage(text, 'mine', dSecs);
  S.bc.tx({ type:'message', p: enc });
}

async function receiveMessage(payload) {
  if (!S.sharedKey) return;
  resetInactivity();
  try {
    const txt = await Crypto.decrypt(S.sharedKey, payload);
    addMessage(txt, 'theirs', payload.d || 0);
  } catch(e) { addMessage('[‚ö† Decryption failed ‚Äî possible tampering]', 'theirs', 0); }
}

function addMessage(text, side, dSecs) {
  const area = document.getElementById('messagesArea');
  const el = document.createElement('div');
  el.className = 'msg ' + side;
  const t = new Date().toLocaleTimeString([], { hour:'2-digit', minute:'2-digit' });
  const uid = 'df' + (++S.messageCount);
  let dbar = dSecs > 0
    ? `<div class="msg-destruct-bar"><div class="msg-destruct-fill" id="${uid}" style="width:100%"></div></div>`
    : '';
  el.innerHTML =
    `<div class="msg-bubble">${esc(text)}</div>${dbar}
     <div class="msg-meta">
       <span class="lock-ico">üîí</span>${t}
       ${side==='mine' ? '¬∑ sent' : '¬∑ received'}
       ${dSecs ? `¬∑ üí£ ${dSecs}s` : ''}
     </div>`;
  area.appendChild(el);
  area.scrollTop = area.scrollHeight;

  if (dSecs > 0) {
    let rem = dSecs;
    const tick = setInterval(() => {
      rem--;
      const f = document.getElementById(uid);
      if (f) f.style.width = (rem / dSecs * 100) + '%';
      if (rem <= 0) {
        clearInterval(tick);
        el.style.transition = 'opacity .4s,transform .4s';
        el.style.opacity = '0'; el.style.transform = 'scale(.9)';
        setTimeout(() => el.remove(), 400);
      }
    }, 1000);
  }
}

function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
function peerEnded() { if (S.bc) { S.bc.shutdown(false); S.bc = null; } destroySession('Other party ended the session.\nAll keys and messages destroyed.'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// END / DESTROY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function endChat() {
  if (!confirm('End session? All keys and messages are permanently destroyed.')) return;
  if (S.bc) { S.bc.shutdown(true); S.bc = null; }
  destroySession('You ended the session.\nAll keys and messages destroyed.');
}

function cancelCreate() {
  clearInterval(timerInterval);
  if (S.bc) { S.bc.shutdown(false); S.bc = null; }
  S.myKeyPair = null; S.code = null; S.passphrase = null;
  showHome();
}

function destroySession(reason) {
  stopInactivityTimer();
  document.getElementById('blurOverlay').classList.remove('active');
  // Shut down transport first, then zero state
  if (S.bc) { try { S.bc.shutdown(false); } catch(e){} S.bc = null; }
  S.myKeyPair = null; S.sharedKey = null; S.code = null;
  S.fingerprint = null; S.passphrase = null; S.messageCount = 0; S.role = null;
  // Clear DOM content
  const area = document.getElementById('messagesArea');
  if (area) area.innerHTML = '';
  const inp = document.getElementById('messageInput');
  if (inp) inp.value = '';
  document.getElementById('destroyReason').innerHTML = reason.replace(/\n/g,'<br>');
  showScreen('destroyedScreen');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SESSION INFO MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showSessionInfo() {
  document.getElementById('fingerprintDisplay').textContent = S.fingerprint || 'Not available';
  document.getElementById('sessionModal').classList.add('active');
}
function closeModal(id) { document.getElementById(id).classList.remove('active'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// QR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function drawQR(data) {
  const canvas = document.getElementById('qrCanvas');
  const size = Math.min(160, Math.floor(window.innerWidth * 0.38));
  canvas.width = size; canvas.height = size;
  try {
    const tmp = document.createElement('div');
    new QRCode(tmp, { text: data, width: size, height: size,
      colorDark:'#12002a', colorLight:'#ffffff', correctLevel: QRCode.CorrectLevel.M });
    setTimeout(() => {
      const el = tmp.querySelector('img') || tmp.querySelector('canvas');
      if (!el) return;
      if (el.tagName === 'IMG') {
        const img = new Image(); img.onload = () => canvas.getContext('2d').drawImage(img,0,0,size,size); img.src = el.src;
      } else { canvas.getContext('2d').drawImage(el,0,0,size,size); }
    }, 80);
  } catch(e) {
    const ctx = canvas.getContext('2d');
    ctx.fillStyle='#fff'; ctx.fillRect(0,0,size,size);
    ctx.fillStyle='#7c3aed';
    for(let i=0;i<7;i++) for(let j=0;j<7;j++) if(Math.random()>.45) ctx.fillRect(8+i*(size/8),8+j*(size/8),size/9,size/9);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TIMER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startTimer() {
  clearInterval(timerInterval); timerSeconds = 300; updateTimer();
  timerInterval = setInterval(() => { timerSeconds--; updateTimer(); if(timerSeconds<=0){clearInterval(timerInterval);cancelCreate();showToast('Code expired','red');} }, 1000);
}
function updateTimer() {
  const m = Math.floor(timerSeconds/60), s = (timerSeconds%60).toString().padStart(2,'0');
  const el = document.getElementById('timerSec'); if(el) el.textContent = m+':'+s;
  const pct = timerSeconds/300*100;
  const fill = document.getElementById('timerFill'); if(!fill) return;
  fill.style.width = pct+'%';
  fill.style.background = pct<25 ? 'var(--red)' : pct<55 ? 'var(--amber)' : 'var(--green)';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SCREEN NAV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.toggle('hidden', s.id !== id));
}
function showHome() { showScreen('homeScreen'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function copyCode() {
  const code = document.getElementById('chatCode').textContent;
  navigator.clipboard.writeText(code).then(() => {
    const btn = document.getElementById('copyBtn');
    btn.textContent = 'COPIED ‚úì'; btn.classList.add('copied');
    setTimeout(() => { btn.textContent = 'COPY'; btn.classList.remove('copied'); }, 2500);
    // Clear clipboard after 30s
    setTimeout(() => { try { navigator.clipboard.writeText(''); } catch(e){} }, 30000);
  }).catch(() => showToast('Copy failed ‚Äî select manually','red'));
}

function formatCodeInput(el) {
  let v = el.value.replace(/[^A-Za-z0-9]/g,'').toUpperCase().slice(0,16);
  el.value = v.match(/.{1,4}/g)?.join('-') || v;
}

function handleMsgKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
}

function onMsgInput(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 130) + 'px';
  resetInactivity();
}

let toastTimeout;
function showToast(msg, type='') {
  const t = document.getElementById('toast');
  t.textContent = msg; t.className = 'toast ' + type + ' show';
  clearTimeout(toastTimeout);
  toastTimeout = setTimeout(() => t.classList.remove('show'), 3200);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STARTUP DIAGNOSTIC
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
(function checkHosting() {
  // If opened as a local file, wss:// will be blocked by Safari/some browsers.
  // Show a clear warning rather than a cryptic relay error.
  if (location.protocol === 'file:') {
    const warn = document.createElement('div');
    warn.style.cssText = [
      'position:fixed','bottom:0','left:0','right:0','z-index:9999',
      'background:#7c3aed','color:#fff','font-family:Space Mono,monospace',
      'font-size:.72rem','padding:10px 16px','text-align:center','line-height:1.5'
    ].join(';');
    warn.innerHTML = '‚ö† Running from local file ‚Äî relay requires HTTPS hosting. '
      + 'Upload to <a href="https://pages.cloudflare.com" target="_blank" '
      + 'style="color:#c084fc">Cloudflare Pages</a> for cross-device use.';
    document.body.appendChild(warn);
  }
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ANTI-FORENSIC / SECURITY HARDENING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Wipe on unload
window.addEventListener('beforeunload', () => {
  S.myKeyPair = null; S.sharedKey = null; S.passphrase = null;
  try { S.bc?.shutdown(true); } catch(e){}
});

// pagehide fires on iOS before suspension/kill
window.addEventListener('pagehide', () => {
  S.myKeyPair = null; S.sharedKey = null; S.passphrase = null;
  try { S.bc?.shutdown(false); } catch(e){}
});

// Defeat BFCache (back-forward cache can restore page with keys in state)
window.addEventListener('pageshow', (e) => { if (e.persisted) window.location.reload(); });

// Disable context menu on sensitive areas
document.addEventListener('contextmenu', e => {
  if (e.target.closest('#messagesArea') || e.target.closest('#chatCode')) e.preventDefault();
});

// Disable drag on images/content
document.addEventListener('dragstart', e => e.preventDefault());

// Clear clipboard on copy after 30s
document.addEventListener('copy', () => {
  setTimeout(() => { try { navigator.clipboard.writeText(''); } catch(e){} }, 30000);
});

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// SECURITY PROPERTIES (all enforced above):
//
// ‚úì Keyboard caching:
//   ‚Äî autocomplete="off" / autocorrect="off" / autocapitalize="off"
//   ‚Äî spellcheck="false" on all sensitive inputs
//   ‚Äî data-gramm="false" disables Grammarly injection
//   ‚Äî type="password" on passphrase (iOS/Android suppress QuickType)
//   ‚Äî input cleared before async send (no residue in DOM/keyboard history)
//
// ‚úì Key protection:
//   ‚Äî PBKDF2-SHA256 (310,000 rounds) wraps session key material
//   ‚Äî Keys held only in JS heap (no IndexedDB / localStorage / cookie)
//   ‚Äî Passphrase zeroed from S.passphrase immediately after use
//   ‚Äî pageshow/pagehide/beforeunload wipe S.*
//
// ‚úì Anti-forensic:
//   ‚Äî BFCache defeated (pageshow reload)
//   ‚Äî DOM messages wiped on destroy
//   ‚Äî No HTTP caching (Cache-Control: no-store)
//   ‚Äî no-referrer meta
//   ‚Äî No screenshots in app-switcher (blur-overlay on visibilitychange)
//   ‚Äî Clipboard auto-wiped 30s after any copy
//
// ‚úì Inactivity:
//   ‚Äî Timer resets on any input/focus
//   ‚Äî 4-min warning banner, 5-min hard wipe
//
// ‚úì Physical access (stolen device):
//   ‚Äî No persistent data anywhere ‚Üí nothing to recover
//   ‚Äî Keys in RAM only ‚Üí cold-boot attack requires PBKDF2 break (infeasible)
//   ‚Äî Message padding hides conversation length patterns
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</script>
</body>
</html>
